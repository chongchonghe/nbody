# README


## Authors

Group 4 : ChongChong He and Mohammed Khalil 


## Description

ASTR615 HW #4: Simulation and Visualization of N-body Problem using particle-particle method and Barnes-Hut tree method

## Problem 1

The directory pp-nbody contains the particle-particle code.
The directory BH-nbody contains the Barnes-Hut code.

### To Compile
cd to either directories and 

    gcc -o main main.c

### To Run

	./main fname outputdir N epsilon t_step n_steps op_freq [integrator]

For example, for 2 bodies with e = 0.5 (default parameters)

	./main 2body0.5.txt ./data 2 0 0.05 4836 4 LF2

for 2 bodies with e = 0.9

	./main 2body0.9.txt ./data 2 0 0.003 56547 50 RK4 


### To produce plots

Data files will be saved in the outputdir (./data)

Run p1_plots.py to produce orbit, phase, and energy plots

Change lines 8 and 9 in the file according to the used method and eccentricity

Plots will be saved to the directory ./plots_p1


### Files Description (in directory BH-nbody)

- main.c   takes input from the user and runs the simulation
 
- definitions.h contains structure and constant definitions

- read_data.h   reads data from initial conditions file

- bhtree.h      builds Barnes-Hut tree

- force.h       performs tree walk and calculates force on each particle

- integ_LF2.h   updates position and velocity using 2nd order leapfrog

- integ Rk4.h   updates position and velocity using 4th order Runge-Kutta

- save_data.h   saves data to output directory 

Files in directory pp-nbody with the same name do similar functions, but use different data structures.


## Problem 2

### Files

Files are in the folder *simulation*. 

- cluster.py: A code to generate the initial conditions for a stellar 
cluster with 1000 particles. The details and methods used are 
described in the writeup. It will also make a figure imf.pdf to compare the IMF 
generated by this code with analytical lines.

- cluster.txt: The initial conditions generated by cluster.py

- mayavi_parallel.py: A parallel code to produce fansy jpg's to visualize 
the outputs. Need to have the Python packages mayavi and mpi4py installed.

- *.ini: The parameters used when running mayavi_parallel.py. They control 
the position and rotation of the camera and more. Detailes are described 
in paramters.ini

- run.sh: A bash script to run all tasks with parameters used in our simulations

- testspeed.py: A python script to run the tasks and count the time it takes to
run each job.


### How to run

An example: to run the simulation of the cluster with pp-nbody code with 
epsilon = 0.01, h = 0.001, num of steps = 200, and an output for every 
1 step, cd into simulations/ and do the following

	../pp-nbody/main cluster.txt cluster 1000 0.01 0.001 200 1

and all the outputs (txt files) will be in the folder cluster/.

To visualize the outputs, use visual_parallel.py. e.g.

	mpirun -np 4 python visual_parallel.py cluster cluster_rotating_camera.ini
	
will run in parallel using 4 CPUs to plot all the outputs in the folder cluster/ 
and create a folder cluster\_jpg to store the jpg's.

Then,

	python makemovie.py cluster_jpg
	
will make a movie form those images in the folder movie.


## TODO

1. Clean unnecessary comment, `*~` files
2. BH-binary: main_binary.c
