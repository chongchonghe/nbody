#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""

@author: chongchonghe
"""

from __future__ import division, print_function
import numpy as np
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
import glob
import time
import sys
import os

if len(sys.argv) != 3:
    raise SystemExit("usage: ./movie2d.py datadir boxsize [starid]")

#plt.style.use('dark_background')

fig, ax = plt.subplots(1, 2, figsize=[12, 6])

boxlen = np.double(sys.argv[2])
lims = [-boxlen, boxlen, -boxlen, boxlen]
if len(sys.argv) == 4:
    startid = int(sys.argv[3])
else:
    startid = 0

outdir = os.path.abspath(sys.argv[1]) + "_fig"
if not os.path.isdir(outdir):
    os.system("mkdir {}".format(outdir))

idx = 0
files = sorted(glob.glob(sys.argv[1] + "/*"))[startid:]

ax[1].plot([0, len(files)], [1, 1])
xlim = ax[1].get_xlim()
ax[1].cla()

for fn in files:
    data = np.loadtxt(fn)
    x = data[:, 1]
    y = data[:, 2]
    ax[0].cla()
    ax[0].axis('equal')
    ax[0].axis(lims)
    #ax[0].plot(x[:-1], y[:-1], '.')
    #ax[0].plot(x[-1], y[-1], '.')
    ax[0].plot(x[0], y[0], '.')
    ax[0].plot(x[1], y[1], '.')
    ax[0].plot(x[2], y[2], '.')
    ax[0].set_xlabel("x")
    ax[0].set_ylabel("y")
    ax[0].set_title("phase plot")
    #plt.draw()

    # plot distance of last two particles in log scale
    ax[1].set_yscale('log')
    ax[1].set_ylim([1e-2, 1e2])
    ax[1].set_xlim(xlim)
    ax[1].plot(idx, np.linalg.norm(data[-2, 1:4] - data[-1, 1:4]),'r.')
    ax[1].set_xlabel('steps')
    ax[1].set_ylabel('separation')
    ax[1].set_title("Binary separation")
    plt.savefig("{}/data_{:04d}.jpg".format(outdir, idx))
    idx += 1
